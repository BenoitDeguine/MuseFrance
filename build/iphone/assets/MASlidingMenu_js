var MASlidingMenu=function(t){var e,i,n,a=Ti.UI.createWindow({exitOnClose:!1}),o=t.left,r=[],d={},s=t.draggable||!0,f={width:void 0,height:void 0},l={slide:200,swipe:150,bounce:100,change_out:120,change_in:300},h={shadowRadius:2,shadowOpacity:.6,shadowOffset:{x:4,y:0},shadowColor:"black"},c="view",u={center:0,offset:0},v=Ti.UI.create2DMatrix();a.addEventListener("postlayout",function(){f={width:a.rect.width/2,height:a.rect.height/2}});var w=function(){if(void 0===o||-1===o.toString().indexOf("TableView"))throw"'left' property must be a Titanium Table view proxy... was:"+o.toString();a.add(o);for(var t=0;t<o.data.length;t++)for(var d=0;d<o.data[t].rowCount;d++){var l=o.data[t].rows[d];if(void 0!==l.navView){var h;if(-1!==l.navView.toString().indexOf("Window"))throw"ViewSlider can only accept UI Views as the table row view property for now";h=l.navView,h.width=Ti.Platform.displayCaps.platformWidth,h.height=Ti.UI.FILL,r.push(h),e||(e=r[r.length-1]),a.add(h),r.length>1&&(h.visible=!1)}else r.push(!1)}i=.8*e.width,n=.2*e.width,f={width:e.width/2,height:e.size.height/2},o.zIndex=1,e.zIndex=2,s&&b(),o.addEventListener("click",function(t){var i;r[t.index]?(i=r[t.index],I(i),p("switch",{view:i,index:r.indexOf(i),menuRow:t.rowData})):(i=e,p("buttonclick",{index:t.index,rowData:t.rowData,source:t.source}),I(e))}),m("open",function(){T("left")}),m("close",function(){T("view")}),m("toggle",function(){T("view"===c?"left":"view")}),a.open()},m=function(t,e){"array"!=typeof d[t]&&(d[t]=[]),d[t].push(e)},p=function(t,e){e.event=t;for(var i in d[t])d[t][i](e)},g=function(){h.shadowOffset.x=-4,o.zIndex=-1},T=function(t){var n;n={left:i,view:0},e.animate(Ti.Android?{left:n[t],duration:l.slide}:{center:{x:n[t]+f.width,y:f.height},duration:l.slide}),c=t,g()},A=function(t){Ti.API.info("touchstart: "+JSON.stringify(t)),Ti.API.info("starting"),u.offset=t.x-f.width,u.center=e.rect.x+f.width},y=function(t){Ti.API.info("touchmove: "+JSON.stringify(t));var n;if(n=t.x-u.offset+e.rect.x,n-=f.width,touchStarted=!1,n>30&&(touchStarted=!0),touchStarted){if(p("sliding",{distance:n}),n>0&&!o)return;if(Math.abs(n)>i)return;n>0&&"left"!==c?(c="left",g()):0===n&&"view"!==c&&(c="view",g()),e.animate({transform:v.translate(n,0),duration:0})}},L=function(t){Ti.API.info("touchend: "+JSON.stringify(t));var a;a=t.x-u.offset+e.rect.x,a-=f.width,a>0&&!o||Math.abs(a)>i||(u.center-f.width===0&&a>n?(Ti.API.info("1"),a>0?(a=i,c="left"):(a=0,c="view"),e.animate({transform:v.translate(260,0),duration:l.bounce})):(a=u.center-f.width,0===a?c="view":a>0&&(c="left"),e.animate({transform:v.translate(0,0),duration:l.swipe})),g())},x=function(t){return Ti.API.info("androidend: "+JSON.stringify(t)),t.left===t.minLeft||t.left===t.maxLeft?void(c=t.left===t.maxLeft?"left":"view"):(t.left>=n?(c="left",e.animate({left:t.source.maxLeft,duration:l.swipe})):(c="view",e.animate({left:0,duration:l.swipe})),void g())},b=function(){"[object TiUIiPhoneNavigationGroup]"===e.toString()?(e.window.addEventListener("touchstart",A),e.window.addEventListener("touchmove",y),e.window.addEventListener("touchend",L),e.window.addEventListener("touchcancel",L)):Ti.Android?e.addEventListener("end",x):(e.addEventListener("touchstart",A),e.addEventListener("touchmove",y),e.addEventListener("touchend",L),e.addEventListener("touchcancel",L))},P=function(){"[object TiUIiPhoneNavigationGroup]"===e.toString()?(e.window.removeEventListener("touchstart",A),e.window.removeEventListener("touchmove",y),e.window.removeEventListener("touchend",L)):Ti.Android?e.removeEventListener("end",x):(e.removeEventListener("touchstart",A),e.removeEventListener("touchmove",y),e.removeEventListener("touchend",L))},I=function(t){Ti.Android?e!==t?(t.hide(),t.left=Ti.Platform.displayCaps.platformWidth,t.width=Ti.Platform.displayCaps.platformWidth,t.height=Ti.UI.FILL,e.animate({left:Ti.Platform.displayCaps.platformWidth,duration:l.change_out},function(){s&&P(),e.hide(),e=t,c="view",e.show(),s&&b(),e.animate({left:0,duration:l.change_in})})):T("view"):e!==t?(t.center={x:f.width,y:f.height},t.hide(),t.animate({transform:v.translate(Ti.Platform.displayCaps.platformWidth,0),duration:.1}),t.width=Ti.Platform.displayCaps.platformWidth,t.height=Ti.UI.FILL,e.animate({transform:v.translate(e.rect.x+(Ti.Platform.displayCaps.platformWidth-e.rect.x),0),duration:l.change_out},function(){s&&P(),e.hide(),e=t,c="view",e.show(),s&&b(),e.animate({transform:v.translate(0,0),duration:l.change_in})})):T("view")};this.draggable=s,this.slideView=T,this.addEventListener=m,this.fireEvent=p,this.open=w,this.destroy=function(){a.close()},this.activeView=function(){return e}};module.exports=MASlidingMenu;